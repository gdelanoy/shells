# /etc/zsh/zshrc ou ~/.zshrc
# Fichier de configuration principal de zsh, lu au lancement des shells interactifs
# (et non des shells d'interpr√©tation de fichier)
# Formation Debian GNU/Linux par Alexis de Lattre
# http://formation-debian.via.ecp.fr/

compinit -U autoload
compinit fire


################
# 1. Les alias #
################

# Gestion du 'ls' : couleur & ne touche pas aux accents
alias ls='ls --classify --tabsize=0 --literal --color=auto --show-control-chars --human-readable'

# Demande confirmation avant d'√©craser un fichier
alias cp='cp --interactive'
alias mv='mv --interactive'
alias rm='rm --interactive'

# Raccourcis pour 'ls'
alias ll='ls -l'
alias la='ls -a'
alias lla='ls -la'

# Quelques alias pratiques
alias c='clear'
alias less='less --quiet'
alias s='cd ..'
alias df='df --human-readable'
alias du='du --human-readable'
alias md='mkdir'
alias rd='rmdir'
alias upgrade='apt-get update && apt-get upgrade && apt-get clean'


#######################################
# 2. Prompt et d√©finition des touches #
#######################################

# Exemple : ma touche HOME, cf  man termcap, est codifiee K1 (upper left
# key  on keyboard)  dans le  /etc/termcap.  En me  referant a  l'entree
# correspondant a mon terminal (par exemple 'linux') dans ce fichier, je
# lis :  K1=\E[1~, c'est la sequence  de caracteres qui sera  envoyee au
# shell. La commande bindkey dit simplement au shell : a chaque fois que
# tu rencontres telle sequence de caractere, tu dois faire telle action.
# La liste des actions est disponible dans "man zshzle".

# Correspondance touches-fonction
bindkey ''    beginning-of-line       # Home
bindkey "\e[1~" beginning-of-line
bindkey "\e[H"  beginning-of-line
bindkey ''    end-of-line             # End
bindkey "\e[4~" end-of-line
bindkey "\e[F"  end-of-line
bindkey ''    delete-char             # Del
bindkey '[3~' delete-char
bindkey '[2~' overwrite-mode          # Insert
bindkey '[5~' history-search-backward # PgUp
bindkey '[6~' history-search-forward  # PgDn

# Prompt couleur (la couleur n'est pas la m√™me pour le root et
# pour les simples utilisateurs)
if [ "`id -u`" -eq 0 ]; then
  export PS1="%{[36;1m%}%T %{[34m%}%n%{[33m%}@%{[37m%}%m %{[32m%}%~ %{[33m%}%#%{[0m%} "
else
  export PS1="%{[36;1m%}%T %{[31m%}%n%{[33m%}@%{[37m%}%m %{[32m%}%~ %{[33m%}%#%{[0m%} "
fi

# Prise en charge des touches [d√©but], [fin] et autres
typeset -A key

key[Home]=${terminfo[khome]}
key[End]=${terminfo[kend]}
key[Insert]=${terminfo[kich1]}
key[Delete]=${terminfo[kdch1]}
key[Up]=${terminfo[kcuu1]}
key[Down]=${terminfo[kcud1]}
key[Left]=${terminfo[kcub1]}
key[Right]=${terminfo[kcuf1]}
key[PageUp]=${terminfo[kpp]}
key[PageDown]=${terminfo[knp]}

[[ -n "${key[Home]}"    ]]  && bindkey  "${key[Home]}"    beginning-of-line
[[ -n "${key[End]}"     ]]  && bindkey  "${key[End]}"     end-of-line
[[ -n "${key[Insert]}"  ]]  && bindkey  "${key[Insert]}"  overwrite-mode
[[ -n "${key[Delete]}"  ]]  && bindkey  "${key[Delete]}"  delete-char
[[ -n "${key[Up]}"      ]]  && bindkey  "${key[Up]}"      up-line-or-history
[[ -n "${key[Down]}"    ]]  && bindkey  "${key[Down]}"    down-line-or-history
[[ -n "${key[Left]}"    ]]  && bindkey  "${key[Left]}"    backward-char
[[ -n "${key[Right]}"   ]]  && bindkey  "${key[Right]}"   forward-char


# Titre de la fen√™tre d'un xterm
case $TERM in
   xterm*)
       precmd () {print -Pn "\e]0;%n@%m: %~\a"}
       ;;
esac

# Gestion de la couleur pour 'ls' (exportation de LS_COLORS)
if [ -x /usr/bin/dircolors ]
then
  if [ -r ~/.dir_colors ]
  then
    eval "`dircolors ~/.dir_colors`"
  elif [ -r /etc/dir_colors ]
  then
    eval "`dircolors /etc/dir_colors`"
  else
    eval "`dircolors`"
  fi
fi


###########################################
# 3. Options de zsh (cf 'man zshoptions') #
###########################################

# Je ne veux JAMAIS de beeps
unsetopt beep
unsetopt hist_beep
unsetopt list_beep
# >| doit √™tre utilis√©s pour pouvoir √©craser un fichier d√©j√† existant ;
# le fichier ne sera pas √©cras√© avec '>'
unsetopt clobber
# Ctrl+D est √©quivalent √† 'logout'
unsetopt ignore_eof
# Affiche le code de sortie si diff√©rent de '0'
setopt print_exit_value
# Demande confirmation pour 'rm *'
unsetopt rm_star_silent
# Correction orthographique des commandes
# D√©sactiv√© car, contrairement √† ce que dit le "man", il essaye de
# corriger les commandes avant de les hasher
#setopt correct
# Si on utilise des jokers dans une liste d'arguments, retire les jokers
# qui ne correspondent √† rien au lieu de donner une erreur
setopt nullglob

# Sch√©mas de compl√©tion

# - Sch√©ma A :
# 1√®re tabulation : compl√®te jusqu'au bout de la partie commune
# 2√®me tabulation : propose une liste de choix
# 3√®me tabulation : compl√®te avec le 1er item de la liste
# 4√®me tabulation : compl√®te avec le 2√®me item de la liste, etc...
# -> c'est le sch√©ma de compl√©tion par d√©faut de zsh.

# Sch√©ma B :
# 1√®re tabulation : propose une liste de choix et compl√®te avec le 1er item
#                   de la liste
# 2√®me tabulation : compl√®te avec le 2√®me item de la liste, etc...
# Si vous voulez ce sch√©ma, d√©commentez la ligne suivante :
#setopt menu_complete

# Sch√©ma C :
# 1√®re tabulation : compl√®te jusqu'au bout de la partie commune et
#                   propose une liste de choix
# 2√®me tabulation : compl√®te avec le 1er item de la liste
# 3√®me tabulation : compl√®te avec le 2√®me item de la liste, etc...
# Ce sch√©ma est le meilleur √† mon go√ªt !
# Si vous voulez ce sch√©ma, d√©commentez la ligne suivante :
#unsetopt list_ambiguous
# (Merci √† Youri van Rietschoten de m'avoir donn√© l'info !)

# Options de compl√©tion
# Quand le dernier caract√®re d'une compl√©tion est '/' et que l'on
# tape 'espace' apr√®s, le '/' est effac√©
setopt auto_remove_slash
# Ne fait pas de compl√©tion sur les fichiers et r√©pertoires cach√©s
unsetopt glob_dots

# Traite les liens symboliques comme il faut
setopt chase_links

# Quand l'utilisateur commence sa commande par '!' pour faire de la
# compl√©tion historique, il n'ex√©cute pas la commande imm√©diatement
# mais il √©crit la commande dans le prompt
setopt hist_verify
# Si la commande est invalide mais correspond au nom d'un sous-r√©pertoire
# ex√©cuter 'cd sous-r√©pertoire'
setopt auto_cd
# L'ex√©cution de "cd" met le r√©pertoire d'o√π l'on vient sur la pile
setopt auto_pushd
# Ignore les doublons dans la pile
setopt pushd_ignore_dups
# N'affiche pas la pile apr√®s un "pushd" ou "popd"
setopt pushd_silent
# "pushd" sans argument = "pushd $HOME"
setopt pushd_to_home

# Les jobs qui tournent en t√¢che de fond sont nic√© √† '0'
unsetopt bg_nice
# N'envoie pas de "HUP" aux jobs qui tourent quand le shell se ferme
unsetopt hup


###############################################
# 4. Param√®tres de l'historique des commandes #
###############################################

# Nombre d'entr√©es dans l'historique
export HISTORY=1000
export SAVEHIST=1000

# Fichier o√π est stock√© l'historique
export HISTFILE=$HOME/.history

# Ajoute l'historique √† la fin de l'ancien fichier
#setopt append_history

# Chaque ligne est ajout√©e dans l'historique √† mesure qu'elle est tap√©e
setopt inc_append_history

# Ne stocke pas  une ligne dans l'historique si elle  est identique √† la
# pr√©c√©dente
setopt hist_ignore_dups

# Supprime les  r√©p√©titions dans le fichier  d'historique, ne conservant
# que la derni√®re occurrence ajout√©e
#setopt hist_ignore_all_dups

# Supprime les  r√©p√©titions dans l'historique lorsqu'il  est plein, mais
# pas avant
setopt hist_expire_dups_first

# N'enregistre  pas plus d'une fois  une m√™me ligne, quelles  que soient
# les options fix√©es pour la session courante
#setopt hist_save_no_dups

# La recherche dans  l'historique avec l'√©diteur de commandes  de zsh ne
# montre  pas  une m√™me  ligne  plus  d'une fois,  m√™me  si  elle a  √©t√©
# enregistr√©e
setopt hist_find_no_dups


###########################################
# 5. Compl√©tion des options des commandes #
###########################################

zstyle ':completion:*' matcher-list '' 'm:{a-z}={A-Z}'
zstyle ':completion:*' max-errors 3 numeric
zstyle ':completion:*' use-compctl false

autoload -U compinit
compinit

# Le logiciel autojump <https://github.com/joelthelion/autojump> fournit un
# moyen d'acc√©der rapidement aux r√©pertoires fr√©quemment visit√©s, en tapant
# simplement ¬´¬†j un_bout_du_nom_du_r√©pertoire¬†¬ª. Si vous souhaitez l'utiliser,
# installez le paquet autojump et d√©commentez la ligne suivante¬†:
#. /usr/share/autojump/autojump.sh

# Trucs perso :

alias -s {yml,yaml,sh,conf}=nvim
alias -g G='| grep -i'
setopt  autocd autopushd \ pushdignoredups
d='dirs -v | head -10'
1='cd -'
2='cd -2'
3='cd -3'
4='cd -4'
5='cd -5'
6='cd -6'
7='cd -7'
8='cd -8'
9='cd -9'

bindkey -v

# Les alias repris du .bashrc :

alias ff='find / -type f -name $1'
alias fd='find / -type d -name $1'
alias ffi='sudo find / -iname $1'
alias colle="ls /tmp/copie* | sed 's|[^\.]*.\.||' | xargs -I % mv /tmp/copie.% ./%"
alias back='cd $OLDPWD'
alias cd..='cd ..'
alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
alias ......="cd ../../../../.."
alias home='cd ~/'
alias documents='cd ~/Documents'
alias downloads='cd ~/Downloads'
alias books='cd ~/eBooks'
alias images='cd ~/Images'
alias videos='cd ~/Videos'
alias web='cd /var/www/html'
alias cp='cp --interactive'
alias mv='mv --interactive'
alias rm='rm --interactive'
alias ls='ls --classify --tabsize=0 --literal --color=auto --show-control-chars --human-readable'
alias ll="ls -lv --group-directories-first"
alias lla='ls -la'
alias llo='ls -aol'
alias lli='ls -AlhGrti'
alias lsd="ls -alF | grep /$"
alias lx='ls -lXB'		# Par extension
alias lk='ls -lSr'		# Par taille
alias lsize='ls --sort=size -lhr' # Ou comme √ßa
alias la='ls -Al'		# Montre les fichiers cach√©s
alias lr='ls -lR'		# R√©cursif
alias lt='ls -ltr'        	# Tri√© par date
alias lm='ls -al |most'        # pip√© dans 'most'
alias l='ls -hF --color'    # quick listing
alias tree='tree -Cs'       
alias less='less --quiet'
alias df='df --human-readable'
alias du='du -h --max-depth=1'
alias psgrep='ps aux |grep -v grep |grep -i'
alias count='du -a | cut -d/ -f2 | sort | uniq -c | sort -nr'
alias findn='find . -iname '"${1}"''
alias tu='top -o cpu' #cpu
alias tm='top -o vsize' #memory
alias biggest='BLOCKSIZE=1048576; du -chx | sort -rh'
alias tf='tail -f '
alias dn='OPTIONS=$(\ls -F | grep /$); select s in $OPTIONS; do cd $PWD/$s; break;done'
alias path='echo -e ${PATH//:/\\n}'
alias xs="cd"
alias vf="cd"
alias see="most"
alias mpv="mpv --no-audio-display"
alias couleurs="grep  '# Color' ~/.bashrc"
alias rot13="tr '[A-Za-z]' '[N-ZA-Mn-za-m]'"
alias wesh="espeak -s 1 -p 0.0001 'wesh'; clear"
alias kikoo="fortune bofh-excuses | cowsay -f $(ls /usr/share/cowsay/cows/ | shuf -n 1) | lolcat"
alias tux='xpenguins -n 50 --all'
alias meteo='curl http://wttr.in/Wasquehal'
alias rouletterusse='[ $[ $RANDOM % 6 ] == 0 ] && echo "T es mort !" || echo "Tu vis."'
alias reload='source ~/.bashrc'
alias confctrl='grep "^[^#]" $1'
alias nocomm='grep -v '^$\|^\s*\#' $1'
alias nslookup='nslookup -sil'
alias LOG="tail -f /var/log/*log /var/log/*/*log"
alias LOGS="find /var/log -type f -exec file {} \; | grep 'text' | cut -d' ' -f1 | sed -e's/:$//g' | grep -v '[0-9]$' | xargs tail -f"
alias dmesg='dmesg -wx'
alias dff='df -h -x tmpfs -x usbfs'
alias psg='ps -ef | grep $1'
alias fastping='ping -c 100 -s.2'
alias ports='netstat -laputn'
alias updb='sudo updatedb &'
alias swapflush="echo swapoff && sudo swapoff -a && echo swapon && sudo swapon -a && echo done"
alias burn='pkill -9'
alias px='ps aux | grep '
alias ct='column -t'
alias dfc='df -hPT | column -t' 
alias mount='mount | column -t'
alias untar='tar -zxvf'
alias ipext='curl ipinfo.io/ip'
alias ipin='hostname -I'
alias myip="ip -br -c a"
alias which='type -all'
alias debug="set -o nounset; set -o xtrace"
alias ssytemctl='systemctl'
alias sstatus="sudo systemctl status -l"
alias srestart="sudo systemctl restart"
alias tue="sudo pkill"
alias mem="free -h"
alias cdtmp="cd $(mktemp -d)"
alias top-commands='history | awk "{print $2}" | awk "BEGIN {FS="|"} {print $1}" |sort|uniq -c | sort -rn | head -10'
alias neo='su -c cmatrix guillaume'
alias cputemp='sensors | grep Core'
alias chx='chmod 755'
alias chr='chmod 644'
alias ipinfo='curl ipinfo.io'
alias alert='notify-send --urgency=low -i "$([ $? = 0 ] && echo terminal || echo error)" "$(history|tail -n1|sed -e '\''s/^\s*[0-9]\+\s*//;s/[;&|]\s*alert$//'\'')"'
alias cmderror='/usr/local/bin/cmderror'
alias showconn="lsof -Pan -i tcp -i udp"
alias mdpdf=" ~/.pandoc/md2pdf"
alias nwho='ping -b -c 2 255.255.255.255 2>&1 | grep "bytes from" | cut -d " " -f 4 | sort | uniq | sed -e "s/://g"'
alias diskspace="du -S | sort -n -r |more"
alias folders="find . -maxdepth 1 -type d -print | xargs du -sk | sort -rn"
alias apti='sudo apt-get install'
alias apts="sudo apt-cache search"
alias aptr='sudo apt-get remove' 
alias orphand='sudo deborphan | xargs sudo apt-get -y remove --purge'
alias aptclean='sudo apt-get autoclean && sudo apt-get autoremove && sudo apt-get clean && sudo apt-get remove && orphand' 
alias maj="sudo apt-get update && sudo apt-get upgrade -y | tee /var/log/divers/packages-update-$(date +%F).log"
alias dodo='sudo /usr/sbin/pm-suspend'
alias die='sudo /sbin/poweroff'
alias reboot='sudo /sbin/reboot'
alias poweroff='sudo /sbin/poweroff'
alias halt='sudo /sbin/poweroff'
alias shutdown='sudo /sbin/shutdown'
alias stamp='date "+%A_%d/%m/%Y_%Hh%M"'
alias d='date +%F'
alias now='date +"%T"'
alias safe-in-cloud='encfs "/home/guillaume/Cloud/MEGAsync/Cloud Drive/Safe/" /home/guillaume/safe-in-cloud/ && df -h | grep -i cloud'
alias safe-on-usb='encfs /media/$USER/USBPRO/Coffre-fort ~/safe-on-usb && df -h | grep safe-on'
alias hop='bash ~/.scripts/byobu-opensession.sh'
alias poe='bash ~/.scripts/byobu-poe.sh'
alias remote1='xtightvncviewer -via "formateur@formation1" localhost:0'
alias remote2='xtightvncviewer -via "formateur@formation2" localhost:0'
alias remote3='xtightvncviewer -via "formateur@formation3" localhost:0'
alias remote4='xtightvncviewer -via "formateur@formation4" localhost:0'
alias remote5='xtightvncviewer -via "formateur@formation5" localhost:0'
alias remote6='xtightvncviewer -via "formateur@formation6" localhost:0'
alias remote7='xtightvncviewer -via "formateur@formation7" localhost:0'
alias remote8='xtightvncviewer -via "formateur@formation8" localhost:0'
alias remote9='xtightvncviewer -via "formateur@formation9" localhost:0'
alias remote10='xtightvncviewer -via "formateur@formation10" localhost:0'
alias sss="ssh formateur@serveur"
alias sse="ssh formateur@serveuse"
alias ss1="ssh formateur@formation1"
alias ss2="ssh formateur@formation2"
alias ss3="ssh formateur@formation3"
alias ss4="ssh formateur@formation4"
alias ss5="ssh formateur@formation5"
alias ss6="ssh formateur@formation6"
alias ss7="ssh formateur@formation7"
alias ss8="ssh formateur@formation8"
alias ss9="ssh formateur@formation9"
alias ss10="ssh formateur@formation10"
alias ssv="ssh formateur@192.168.20.82"
alias ssv2="ssh formateur@192.168.20.83"
alias vm7='ssh formation@serveur -p 2200$(echo $HOSTNAME | tail -c2)'
alias {G,g}{re,er}p='grep'
alias grep -E='grep -E --color=auto'
alias grep -F='grep -F --color=auto'
alias grep='grep --color=auto'
alias please='sudo $(history -p \!\!)'
alias sduo='sudo'
alias suod='sudo'
alias svi='sudo nvim'
alias us="su"
alias vi='nvim'
alias edit='nvim'
alias emacs='nvim'
alias iptl='sudo /sbin/iptables -L -n -v --line-numbers'
alias iptlin='sudo /sbin/iptables -L INPUT -n -v --line-numbers'
alias iptlout='sudo /sbin/iptables -L OUTPUT -n -v --line-numbers'
alias iptlfw='sudo /sbin/iptables -L FORWARD -n -v --line-numbers'
alias iptlnat='sudo /sbin/iptables -t nat -n -v --line-numbers'
alias yolo='git add . && git commit -a -m "Commit du $(date "+%A %d %B %Y"), √† $(date "+%H heures %M" ) ." && git push origin master'
alias gitar="git ls-files -d -m -o -z --exclude-standard | xargs -0 git update-index --add --remove"
alias g='git'
alias gpd='git push origin develop'
alias gpm='git push origin master'
alias gst='git status'
alias gcom='git commit -m --all'
alias gclo='git clone'
alias glog='git log'
alias gadd='git add . --verbose'
alias gco='git checkout'
alias gls='git ls-files'
alias gpall='git push --all'
alias msr='mysql -u root -p'
alias restartapache='sudo systemctl restart apache2 && sudo systemctl status -l apache2'
alias apachedit='sudo vim /etc/apache2/apache2.conf'
alias apachegrace='sudo apachectl graceful'
alias apachelog="less +F /var/log/apache2/*.log"
alias accio=ansibleSetup
alias ans='ansible'
alias ansp='ansible-playbook'
alias lxcls="lxc-ls --fancy"
alias lxcat="lxc-attach -n $@"
alias lxcstop="lxc-stop -n $@"
alias lxcstart="lxc-start -n $@"
alias box='box=$(yad --title=Voyager --window-icon="/usr/share/xfce4/voyager/p1.png" --image="/usr/share/xfce4/voyager/Voyager0.png" --image-on-top --separator="" --width=300 --height=260 --list --radiolist --no-headers --column="1" --column="option" --print-column 2 true "Voyager Wall" false "Conky Control" false "Plank Control" false "Colors Icons" false "Reparation" false "System Infos")'

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
